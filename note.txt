Integrating getAllRepayment controller

âœ… What this does:
Retrieves all repayments from the database.

Uses .populate() to include useful info from related User and Loan models.

Sorts repayments by most recent paymentDate.

Let me know if you want to add filters like by date, user, or loan type.

ðŸ“˜ 10-Line Explanation of the Code
This controller fetches all repayment records from the database.

It populates related user and loan fields to include user info and loan details.

The repayments are sorted by paymentDate in descending order (latest first).

It groups repayments by loan ID to calculate the total amount paid for each loan.

For each repayment, it builds a new response object (enhancedRepayments).

It includes key info like last payment, total paid so far, and current balance.

If the loan is active, it shows the repayment balance; otherwise, it returns 0.

The balance and payment figures are rounded using Math.round() to avoid decimals.

The result includes enriched loan and user details for admin visibility.

Finally, it sends a success response with the total number and full repayment data.